{
  "cells": [
    {
      "cell_type": "markdown",
      "source": [
        "# Tutorial: Create production ML pipelines with Python SDK v2 (preview) in a Jupyter notebook\n"
      ],
      "metadata": {}
    },
    {
      "cell_type": "markdown",
      "source": [
        "**Learning Objectives** - By the end of this two part tutorial, you should be able to use Azure Machine Learning (Azure ML) to productionize your ML project.\n",
        "\n",
        "This means you will be able to leverage the AzureML Python SDK to:\n",
        "\n",
        "- connect to your Azure ML workspace\n",
        "- create Azure ML data assets\n",
        "- create reusable Azure ML components\n",
        "- create, validate and run Azure ML pipelines\n",
        "- deploy the newly-trained model as an endpoint\n",
        "- call the Azure ML endpoint for inferencing"
      ],
      "metadata": {}
    },
    {
      "cell_type": "markdown",
      "source": [
        "**Motivations** - This tutorial is intended to introduce Azure ML to data scientists who want to scale up or publish their ML projects. By completing a familiar end-to-end project, which starts by loading the data and ends by creating and calling an online inference endpoint, the user should become familiar with the core concepts of Azure ML and their most common usage. Each step of this tutorial can be modified or performed in other ways that might have security or scalability advantages. We will cover some of those in the Part II of this tutorial, however, we suggest the reader use the provide links in each section to learn more on each topic."
      ],
      "metadata": {}
    },
    {
      "cell_type": "markdown",
      "source": [
        "**Requirements** - In order to benefit from this tutorial, you need to have:\n",
        "- basic understanding of Machine Learning projects workflow\n",
        "- an Azure subscription. If you don't have an Azure subscription, [create a free account](https://aka.ms/AMLFree) before you begin.\n",
        "- a working Azure ML workspace. A workspace can be created via Azure Portal, Azure CLI, or Python SDK. [Read more](https://docs.microsoft.com/en-us/azure/machine-learning/how-to-manage-workspace?tabs=python).\n",
        "- a Python environmnet\n",
        "- [installed Azure Machine Learning Python SDK v2](https://github.com/Azure/azureml-examples/blob/sdk-preview/sdk/setup.sh)"
      ],
      "metadata": {}
    },
    {
      "cell_type": "markdown",
      "source": [
        "## Introduction\n",
        "\n",
        "In this tutorial, you'll create an Azure ML pipeline to train a model for credit default prediction. The pipeline handles the data preparation, training and registering the trained model.  You'll then run the pipeline, deploy the model and use it.\n",
        "\n",
        "The image below shows the pipeline as you'll see it in the AzureML portal once submitted. It's a rather simple pipeline we'll use to walk you through the AzureML SDK v2.\n",
        "\n",
        "The two steps are first data preparation and second training. \n",
        "\n",
        "![Screenshot that shows the AML Pipeline](media/pipeline-overview.jpg \"Overview of the pipeline\")\n",
        "\n",
        "An AzureML pipeline that runs from local components, requires several dependent files. Fo better understanding of the project structure, we produce all these dependencies in the notebook cells. By the end of this tutorial, the project structure should look like:\n",
        "```\n",
        "e2e-ds-experience  \n",
        "    components\n",
        "        data_prep\n",
        "            data_prep.py\n",
        "            data_prep.yml  \n",
        "        train\n",
        "            train.py\n",
        "            train.yml   \n",
        "    dependencies\n",
        "        conda.yml\n",
        "    deploy\n",
        "        sample-request.json\n",
        "    media\n",
        "        metrics.jpg\n",
        "        pipeline-overview.jpg\n",
        "        user-logs.jpg\n",
        "    e2e-ml-workflow.ipynb\n",
        "```\n",
        "After running this notebook, you should be able to create the project direcetly in the IDE of your choice, instead.\n",
        "\n",
        "## Set up the pipeline resources\n",
        "\n",
        "The Azure ML framework can be used from CLI, Python SDK, or studio interface. In this example, you'll use the AzureML Python SDK v2 to create a pipeline. \n",
        "\n",
        "Before creating the pipeline, you'll set up the resources the pipeline will use:\n",
        "\n",
        "* The dataset for training\n",
        "* The software environment to run the pipeline\n",
        "* A compute resource to where the job will run\n",
        "\n",
        "## AML을 시작하기위한 주요흐름\n",
        "\n",
        "1. Connect to Azure Machine Learning workspace\n",
        "\n",
        "2. Create compute\n",
        "\n",
        "3. Create a job environment\n",
        "\n",
        "4. Build the command job to data preparation and train\n",
        "\n",
        "5. Configure the Command\n",
        "\n",
        "6. Submit the job\n",
        "\n",
        "## Connect to the workspace\n",
        "\n",
        "Before we dive in the code, you'll need to connect to your Azure ML workspace. The workspace is the top-level resource for Azure Machine Learning, providing a centralized place to work with all the artifacts you create when you use Azure Machine Learning.\n",
        "\n",
        "We are using `DefaultAzureCredential` to get access to workspace. \n",
        "`DefaultAzureCredential` should be capable of handling most Azure SDK authentication scenarios. \n",
        "\n",
        "Reference for more available credentials if it does not work for you: [configure credential example](../../configuration.ipynb), [azure-identity reference doc](https://docs.microsoft.com/en-us/python/api/azure-identity/azure.identity?view=azure-python)."
      ],
      "metadata": {}
    },
    {
      "cell_type": "code",
      "source": [
        "# Handle to the workspace\n",
        "from azure.ai.ml import MLClient\n",
        "\n",
        "# Authentication package\n",
        "from azure.identity import DefaultAzureCredential, InteractiveBrowserCredential\n",
        "\n",
        "try:\n",
        "    credential = DefaultAzureCredential()\n",
        "    # Check if given credential can get token successfully.\n",
        "    credential.get_token(\"https://management.azure.com/.default\")\n",
        "except Exception as ex:\n",
        "    # Fall back to InteractiveBrowserCredential in case DefaultAzureCredential not work\n",
        "    credential = InteractiveBrowserCredential()"
      ],
      "outputs": [],
      "execution_count": 113,
      "metadata": {
        "attributes": {
          "classes": [
            "Python"
          ],
          "id": ""
        },
        "gather": {
          "logged": 1678281669523
        },
        "name": "import-mlclient"
      }
    },
    {
      "cell_type": "markdown",
      "source": [
        "In the next cell, enter your Subscription ID, Resource Group name and Workspace name. To find your Subscription ID:\n",
        "1. In the upper right Azure Machine Learning Studio toolbar, select your workspace name.\n",
        "1. At the bottom, select **View all properties in Azure Portal**\n",
        "1. Copy the value from Azure Portal into the code."
      ],
      "metadata": {}
    },
    {
      "cell_type": "code",
      "source": [
        "# Get a handle to the workspace\n",
        "ml_client = MLClient(\n",
        "    credential=credential,\n",
        "    subscription_id=\"<subscription_id>\",\n",
        "    resource_group_name=\"<resource_group_name>\",\n",
        "    workspace_name=\"<workspace_name>\",\n",
        ")"
      ],
      "outputs": [],
      "execution_count": 114,
      "metadata": {
        "attributes": {
          "classes": [
            "Python"
          ],
          "id": ""
        },
        "gather": {
          "logged": 1678281671827
        },
        "name": "ml_client"
      }
    },
    {
      "cell_type": "code",
      "source": [
        "# Get a handle to the workspace\n",
        "ml_client = MLClient(\n",
        "    credential=credential,\n",
        "    subscription_id=\"996049d2-a088-4535-84c6-293862437c2e\",\n",
        "    resource_group_name=\"rg-aml-demo\",\n",
        "    workspace_name=\"ssc-mlops\",\n",
        ")"
      ],
      "outputs": [],
      "execution_count": 115,
      "metadata": {
        "gather": {
          "logged": 1678281674786
        }
      }
    },
    {
      "cell_type": "code",
      "source": [
        "from azure.ai.ml.entities import Data\r\n",
        "from azure.ai.ml.constants import AssetTypes\r\n",
        "\r\n",
        "web_path = \"https://sscdata.blob.core.windows.net/input/creditcardclients.xls\"\r\n",
        "\r\n",
        "credit_data = Data(\r\n",
        "    name=\"sscinpudata\",\r\n",
        "    path=web_path,\r\n",
        "    type=AssetTypes.URI_FILE,\r\n",
        "    description=\"Dataset for credit card defaults\",\r\n",
        "    tags={\"source_type\": \"web\", \"source\": \"UCI ML Repo\"},\r\n",
        "    # version=\"1.0.1\",\r\n",
        ")"
      ],
      "outputs": [],
      "execution_count": 128,
      "metadata": {
        "jupyter": {
          "source_hidden": false,
          "outputs_hidden": false
        },
        "nteract": {
          "transient": {
            "deleting": false
          }
        },
        "gather": {
          "logged": 1678282609731
        }
      }
    },
    {
      "cell_type": "code",
      "source": [
        "credit_data = ml_client.data.create_or_update(credit_data)\r\n",
        "print(\r\n",
        "    f\"Dataset with name {credit_data.name} was registered to workspace, the dataset version is {credit_data.version}\"\r\n",
        ")"
      ],
      "outputs": [
        {
          "output_type": "stream",
          "name": "stdout",
          "text": "Dataset with name sscinpudata was registered to workspace, the dataset version is 4\n"
        }
      ],
      "execution_count": 129,
      "metadata": {
        "jupyter": {
          "source_hidden": false,
          "outputs_hidden": false
        },
        "nteract": {
          "transient": {
            "deleting": false
          }
        },
        "gather": {
          "logged": 1678282615031
        }
      }
    },
    {
      "cell_type": "code",
      "source": [
        "credit_data.version"
      ],
      "outputs": [
        {
          "output_type": "execute_result",
          "execution_count": 121,
          "data": {
            "text/plain": "'3'"
          },
          "metadata": {}
        }
      ],
      "execution_count": 121,
      "metadata": {
        "jupyter": {
          "source_hidden": false,
          "outputs_hidden": false
        },
        "nteract": {
          "transient": {
            "deleting": false
          }
        },
        "gather": {
          "logged": 1678281736026
        }
      }
    },
    {
      "cell_type": "markdown",
      "source": [
        "The result is a handler to the workspace that you'll use to manage other resources and jobs.\n",
        "\n",
        "> [!IMPORTANT]\n",
        "> Creating MLClient will not connect to the workspace. The client initialization is lazy, it will wait for the first time it needs to make a call (in the notebook below, that will happen during dataset registration).\n",
        "\n",
        "## Register data from an external url\n",
        "\n",
        "The data you use for training is usually in one of the locations below:\n",
        "\n",
        "* Local machine\n",
        "* Web\n",
        "* Big Data Storage services (for example, Azure Blob, Azure Data Lake Storage, SQL)\n",
        " \n",
        "Azure ML uses a [`Data`](https://docs.microsoft.com/azure/machine-learning/how-to-create-register-data-assets?tabs=Python-SDK) object to register a reusable definition of data, and consume data within a pipeline. In the section below, you'll consume some data from web url as one example. `Data` assets ets from other sources can be created as well."
      ],
      "metadata": {}
    },
    {
      "cell_type": "markdown",
      "source": [
        "## 외부 데이터셋 등록 방법."
      ],
      "metadata": {
        "nteract": {
          "transient": {
            "deleting": false
          }
        }
      }
    },
    {
      "cell_type": "code",
      "source": [
        "# from azure.ai.ml.entities import Data\n",
        "# from azure.ai.ml.constants import AssetTypes\n",
        "\n",
        "# web_path = \"https://archive.ics.uci.edu/ml/machine-learning-databases/00350/default%20of%20credit%20card%20clients.xls\"\n",
        "\n",
        "# credit_data = Data(\n",
        "#     name=\"inputdata\",\n",
        "#     path=web_path,\n",
        "#     type=AssetTypes.URI_FILE,\n",
        "#     description=\"Dataset for credit card defaults\",\n",
        "#     tags={\"source_type\": \"web\", \"source\": \"UCI ML Repo\"},\n",
        "#     version=\"1.0.1\",\n",
        "# )"
      ],
      "outputs": [],
      "execution_count": 80,
      "metadata": {
        "gather": {
          "logged": 1678182211606
        },
        "name": "credit_data"
      }
    },
    {
      "cell_type": "markdown",
      "source": [
        "This code just created a `Data` asset, it is ready to be consumed as an input by the pipeline that you'll define in the next sections. In addition, you can register the data to your workspace so it becomes reusable across pipelines.\n",
        "\n",
        "Registering the data asset will enable you to:\n",
        "\n",
        "* reuse and share the data asset in future pipelines\n",
        "* use versions to track the modification to the data asset\n",
        "* use the data asset from Azure ML designer, which is Azure ML's GUI for pipeline authoring\n",
        "\n",
        "Since this is the first time that you're making a call to the workspace, you may be asked to authenticate. Once the authentication is complete, you'll then see the dataset registration completion message."
      ],
      "metadata": {}
    },
    {
      "cell_type": "code",
      "source": [
        "# credit_data = ml_client.data.create_or_update(credit_data)\n",
        "# print(\n",
        "#     f\"Dataset with name {credit_data.name} was registered to workspace, the dataset version is {credit_data.version}\"\n",
        "# )"
      ],
      "outputs": [],
      "execution_count": 81,
      "metadata": {
        "attributes": {
          "classes": [
            "Python"
          ],
          "id": ""
        },
        "gather": {
          "logged": 1678182212610
        },
        "name": "update-credit_data"
      }
    },
    {
      "cell_type": "markdown",
      "source": [
        "## Azure Machine Learning Studio 에서 sscinpudata inputdata를 등록한다.(데이터 메뉴로 이동.)"
      ],
      "metadata": {
        "nteract": {
          "transient": {
            "deleting": false
          }
        }
      }
    },
    {
      "cell_type": "code",
      "source": [
        "credit_data = ml_client.data.get(name=\"sscinpudata\", version=credit_data.version)\n",
        "print(\n",
        "    f\"Dataset with name {credit_data.name} was registered to workspace, the dataset version is {credit_data.version}\"\n",
        ")"
      ],
      "outputs": [
        {
          "output_type": "stream",
          "name": "stdout",
          "text": "Dataset with name sscinpudata was registered to workspace, the dataset version is 4\n"
        }
      ],
      "execution_count": 130,
      "metadata": {
        "gather": {
          "logged": 1678282622122
        },
        "jupyter": {
          "outputs_hidden": false,
          "source_hidden": false
        },
        "nteract": {
          "transient": {
            "deleting": false
          }
        }
      }
    },
    {
      "cell_type": "code",
      "source": [
        "credit_evaldata = ml_client.data.get(name=\"sscinpudatatest\", version=\"1\")\n",
        "print(\n",
        "    f\"Dataset with name {credit_evaldata.name} was registered to workspace, the dataset version is {credit_evaldata.version}\"\n",
        ")"
      ],
      "outputs": [
        {
          "output_type": "stream",
          "name": "stdout",
          "text": "Dataset with name sscinpudatatest was registered to workspace, the dataset version is 1\n"
        }
      ],
      "execution_count": 78,
      "metadata": {
        "gather": {
          "logged": 1678280298337
        }
      }
    },
    {
      "cell_type": "markdown",
      "source": [
        "In the future, you can fetch the same dataset from the workspace using `credit_dataset = ml_client.data.get(\"<DATA ASSET NAME>\", version='<VERSION>')`.\n",
        "\n",
        "## Create a Compute Resource to run our pipeline\n",
        "\n",
        "Each step of an Azure ML pipeline can use a different compute resource for running the specific job of that step. It can be single or multi-node machines with Linux or Windows OS, or a specific compute fabric like Spark.\n",
        "\n",
        "In this section, we provision a Linux [compute cluster](https://docs.microsoft.com/azure/machine-learning/how-to-create-attach-compute-cluster?tabs=python). See the [full list on VM sizes and prices](https://azure.microsoft.com/en-ca/pricing/details/machine-learning/) .\n",
        "\n",
        "For this tutorial we only need a basic cluster, let's pick a Standard_DS3_v2 model with 2 vCPU cores, 7 GB RAM and create an Azure ML Compute\n",
        "\n",
        "AML 스튜디오에서 해당 클러스터를 생성할수도 있음."
      ],
      "metadata": {}
    },
    {
      "cell_type": "code",
      "source": [
        "from azure.ai.ml.entities import AmlCompute\n",
        "\n",
        "cpu_compute_target = \"cpu-cluster\"\n",
        "\n",
        "try:\n",
        "    # let's see if the compute target already exists\n",
        "    cpu_cluster = ml_client.compute.get(cpu_compute_target)\n",
        "    print(\n",
        "        f\"You already have a cluster named {cpu_compute_target}, we'll reuse it as is.\"\n",
        "    )\n",
        "\n",
        "except Exception:\n",
        "    print(\"Creating a new cpu compute target...\")\n",
        "\n",
        "    # Let's create the Azure ML compute object with the intended parameters\n",
        "    cpu_cluster = AmlCompute(\n",
        "        # Name assigned to the compute cluster\n",
        "        name=\"cpu-cluster\",\n",
        "        # Azure ML Compute is the on-demand VM service\n",
        "        type=\"amlcompute\",\n",
        "        # VM Family\n",
        "        size=\"STANDARD_DS3_V2\",\n",
        "        # Minimum running nodes when there is no job running\n",
        "        min_instances=0,\n",
        "        # Nodes in cluster\n",
        "        max_instances=4,\n",
        "        # How many seconds will the node running after the job termination\n",
        "        idle_time_before_scale_down=180,\n",
        "        # Dedicated or LowPriority. The latter is cheaper but there is a chance of job termination\n",
        "        tier=\"Dedicated\",\n",
        "    )\n",
        "\n",
        "    # Now, we pass the object to MLClient's create_or_update method\n",
        "    cpu_cluster = ml_client.begin_create_or_update(cpu_cluster)\n",
        "\n",
        "print(\n",
        "    f\"AMLCompute with name {cpu_cluster.name} is created, the compute size is {cpu_cluster.size}\"\n",
        ")"
      ],
      "outputs": [
        {
          "output_type": "stream",
          "name": "stdout",
          "text": "You already have a cluster named cpu-cluster, we'll reuse it as is.\nAMLCompute with name cpu-cluster is created, the compute size is STANDARD_DS3_V2\n"
        }
      ],
      "execution_count": 79,
      "metadata": {
        "gather": {
          "logged": 1678280316306
        },
        "name": "cpu_cluster"
      }
    },
    {
      "cell_type": "markdown",
      "source": [
        "## Create a job environment for pipeline steps\n",
        "\n",
        "So far, you've created a development environment on the compute instance, your development machine. You'll also need an [environment](https://docs.microsoft.com/azure/machine-learning/concept-environments) to use for each step of the pipeline. Each step can have its own environment, or you can use some common environments for multiple steps.\n",
        "\n",
        "In this example, you'll create a conda environment for your jobs, using a conda yaml file.\n",
        "First, create a directory to store the file in."
      ],
      "metadata": {}
    },
    {
      "cell_type": "code",
      "source": [
        "import os\n",
        "\n",
        "dependencies_dir = \"./dependencies\"\n",
        "os.makedirs(dependencies_dir, exist_ok=True)"
      ],
      "outputs": [],
      "execution_count": 80,
      "metadata": {
        "gather": {
          "logged": 1678280320280
        },
        "name": "dependencies_dir"
      }
    },
    {
      "cell_type": "markdown",
      "source": [
        "Now, create the file in the dependencies directory."
      ],
      "metadata": {}
    },
    {
      "cell_type": "code",
      "source": [
        "%%writefile {dependencies_dir}/conda.yml\n",
        "name: model-env\n",
        "channels:\n",
        "  - conda-forge\n",
        "dependencies:\n",
        "  - python=3.8\n",
        "  - numpy=1.21.2\n",
        "  - pip=21.2.4\n",
        "  - scikit-learn=0.24.2\n",
        "  - scipy=1.7.1\n",
        "  - pandas>=1.1,<1.2\n",
        "  - pip:\n",
        "    - inference-schema[numpy-support]==1.3.0\n",
        "    - xlrd==2.0.1\n",
        "    - mlflow== 1.26.1\n",
        "    - azureml-mlflow==1.42.0"
      ],
      "outputs": [
        {
          "output_type": "stream",
          "name": "stdout",
          "text": "Overwriting ./dependencies/conda.yml\n"
        }
      ],
      "execution_count": 81,
      "metadata": {
        "attributes": {
          "classes": [
            "Python"
          ],
          "id": ""
        },
        "name": "conda.yml"
      }
    },
    {
      "cell_type": "code",
      "source": [
        "%%writefile {dependencies_dir}/conda_score.yml\n",
        "name: model-env\n",
        "channels:\n",
        "  - conda-forge\n",
        "dependencies:\n",
        "  - python=3.8\n",
        "  - numpy=1.21.2\n",
        "  - pip=21.2.4\n",
        "  - scikit-learn=1.0.0\n",
        "  - scipy=1.7.1\n",
        "  - pandas>=1.1,<1.2\n",
        "  - pip:\n",
        "    - inference-schema[numpy-support]==1.3.0\n",
        "    - xlrd==2.0.1\n",
        "    - mlflow== 1.26.1\n",
        "    - azureml-mlflow==1.42.0"
      ],
      "outputs": [
        {
          "output_type": "stream",
          "name": "stdout",
          "text": "Overwriting ./dependencies/conda_score.yml\n"
        }
      ],
      "execution_count": 82,
      "metadata": {
        "jupyter": {
          "outputs_hidden": false,
          "source_hidden": false
        },
        "nteract": {
          "transient": {
            "deleting": false
          }
        }
      }
    },
    {
      "cell_type": "markdown",
      "source": [
        "The specification contains some usual packages, that you'll use in your pipeline (numpy, pip).\n",
        "\n",
        "\n",
        "Use the *yaml* file to create and register this custom environment in your workspace:"
      ],
      "metadata": {}
    },
    {
      "cell_type": "markdown",
      "source": [
        "## ML을 위한 환경등록 재사용가능"
      ],
      "metadata": {
        "nteract": {
          "transient": {
            "deleting": false
          }
        }
      }
    },
    {
      "cell_type": "code",
      "source": [
        "from azure.ai.ml.entities import Environment\n",
        "\n",
        "custom_env_name = \"aml-score-custom\"\n",
        "\n",
        "pipeline_job_env_custom = Environment(\n",
        "    name=custom_env_name,\n",
        "    description=\"Custom environment for Credit Card Defaults pipeline\",\n",
        "    tags={\"scikit-learn\": \"1.0.0\"},\n",
        "    conda_file=os.path.join(dependencies_dir, \"conda_score.yml\"),\n",
        "    image=\"mcr.microsoft.com/azureml/openmpi4.1.0-ubuntu20.04:latest\",\n",
        "    version=\"0.1.0\",\n",
        ")\n",
        "pipeline_job_env_custom = ml_client.environments.create_or_update(pipeline_job_env_custom)\n",
        "\n",
        "print(\n",
        "    f\"Environment with name {pipeline_job_env_custom.name} is registered to workspace, the environment version is {pipeline_job_env_custom.version}\"\n",
        ")"
      ],
      "outputs": [
        {
          "output_type": "stream",
          "name": "stdout",
          "text": "Environment with name aml-score-custom is registered to workspace, the environment version is 0.1.0\n"
        }
      ],
      "execution_count": 68,
      "metadata": {
        "gather": {
          "logged": 1678280068999
        }
      }
    },
    {
      "cell_type": "code",
      "source": [
        "from azure.ai.ml.entities import Environment\n",
        "\n",
        "custom_env_name = \"aml-scikit-learn\"\n",
        "\n",
        "pipeline_job_env = Environment(\n",
        "    name=custom_env_name,\n",
        "    description=\"Custom environment for Credit Card Defaults pipeline\",\n",
        "    tags={\"scikit-learn\": \"0.24.2\"},\n",
        "    conda_file=os.path.join(dependencies_dir, \"conda.yml\"),\n",
        "    image=\"mcr.microsoft.com/azureml/openmpi4.1.0-ubuntu20.04:latest\",\n",
        "    version=\"0.1.0\",\n",
        ")\n",
        "pipeline_job_env = ml_client.environments.create_or_update(pipeline_job_env)\n",
        "\n",
        "print(\n",
        "    f\"Environment with name {pipeline_job_env.name} is registered to workspace, the environment version is {pipeline_job_env.version}\"\n",
        ")"
      ],
      "outputs": [
        {
          "output_type": "stream",
          "name": "stdout",
          "text": "Environment with name aml-scikit-learn is registered to workspace, the environment version is 0.1.0\n"
        }
      ],
      "execution_count": 69,
      "metadata": {
        "attributes": {
          "classes": [
            "Python"
          ],
          "id": ""
        },
        "gather": {
          "logged": 1678280079993
        },
        "name": "custom_env_name"
      }
    },
    {
      "cell_type": "markdown",
      "source": [
        "## Build the training pipeline\n",
        "\n",
        "Now that you have all assets required to run your pipeline, it's time to build the pipeline itself, using the Azure ML Python SDK v2.\n",
        "\n",
        "Azure ML pipelines are reusable ML workflows that usually consist of several components. The typical life of a component is:\n",
        "\n",
        "* Write the yaml specification of the component.\n",
        "* Optionally, register the component with a name and version in your workspace, to make it reusable and shareable.\n",
        "* Load that component from the pipeline code.\n",
        "* Implement the pipeline using this component inputs, outputs and parameters.\n",
        "* Submit the pipeline.\n",
        "\n",
        "## Create component 1: data prep \n",
        "\n",
        "Let's start by creating the first component. This component handles the preprocessing of the data. The preprocessing task is performed in the *data_prep.py* python file.\n",
        "\n",
        "First create a source folder for the data_prep component:"
      ],
      "metadata": {}
    },
    {
      "cell_type": "code",
      "source": [
        "import os\n",
        "\n",
        "data_prep_src_dir = \"./components/data_prep\"\n",
        "os.makedirs(data_prep_src_dir, exist_ok=True)"
      ],
      "outputs": [],
      "execution_count": 83,
      "metadata": {
        "attributes": {
          "classes": [
            "Python"
          ],
          "id": ""
        },
        "gather": {
          "logged": 1678280336930
        },
        "name": "data_prep_src_dir"
      }
    },
    {
      "cell_type": "markdown",
      "source": [
        "This script performs the simple task of splitting the data into train and test datasets. \n",
        "\n",
        "[MLFlow](https://mlflow.org/docs/latest/tracking.html) will be used to log the parameters and metrics during our pipeline run."
      ],
      "metadata": {}
    },
    {
      "cell_type": "markdown",
      "source": [
        "## component 1: data_prep.py"
      ],
      "metadata": {
        "nteract": {
          "transient": {
            "deleting": false
          }
        }
      }
    },
    {
      "cell_type": "markdown",
      "source": [
        "Now that you have a script that can perform the desired task, we can create an Azure ML Component from it. Azure ML support various types of components for performing ML tasks, such as running scripts, data transfer, etc.\n",
        "\n",
        "A component can be created by calling the component instantiators, or directly writing the defining yaml file. \n",
        "\n",
        "You'll use the general purpose **command** that can run command line actions. This command line action can be directly calling system commands or running a script. The inputs/outputs are accessible in the command via the `${{ ... }}` notation. For the second component of this tutorial you will use `yaml` definitions.\n"
      ],
      "metadata": {}
    },
    {
      "cell_type": "code",
      "source": [
        "# importing the Component Package\n",
        "from azure.ai.ml import load_component\n",
        "\n",
        "# Loading the component from the yml file\n",
        "data_prep_component = load_component(source=os.path.join(data_prep_src_dir, \"data_prep.yml\"))"
      ],
      "outputs": [],
      "execution_count": 84,
      "metadata": {
        "gather": {
          "logged": 1678280346755
        },
        "jupyter": {
          "outputs_hidden": false,
          "source_hidden": false
        },
        "nteract": {
          "transient": {
            "deleting": false
          }
        }
      }
    },
    {
      "cell_type": "markdown",
      "source": [
        "## register the component to the workspace (option)"
      ],
      "metadata": {}
    },
    {
      "cell_type": "code",
      "source": [
        "# Now we register the component to the workspace\n",
        "data_prep_component = ml_client.create_or_update(data_prep_component)\n",
        "\n",
        "# Create (register) the component in your workspace\n",
        "print(\n",
        "    f\"Component {data_prep_component.name} with Version {data_prep_component.version} is registered\"\n",
        ")"
      ],
      "outputs": [
        {
          "output_type": "stream",
          "name": "stdout",
          "text": "Component data_prep_credit_defaults with Version 2023-03-08-07-35-01-1217626 is registered\n"
        }
      ],
      "execution_count": 55,
      "metadata": {
        "gather": {
          "logged": 1678198533181
        },
        "jupyter": {
          "outputs_hidden": false,
          "source_hidden": false
        },
        "nteract": {
          "transient": {
            "deleting": false
          }
        }
      }
    },
    {
      "cell_type": "markdown",
      "source": [
        "## component 1: command 설정 (programming 설정)"
      ],
      "metadata": {
        "nteract": {
          "transient": {
            "deleting": false
          }
        }
      }
    },
    {
      "cell_type": "code",
      "source": [
        "# from azure.ai.ml import command\n",
        "# from azure.ai.ml import Input, Output\n",
        "\n",
        "# data_prep_component = command(\n",
        "#     name=\"data_prep_credit_defaults\",\n",
        "#     display_name=\"Data preparation for training\",\n",
        "#     description=\"reads a .xl input, split the input to train and test\",\n",
        "#     inputs={\n",
        "#         \"data\": Input(type=\"uri_folder\"),\n",
        "#         \"test_train_ratio\": Input(type=\"number\"),\n",
        "#     },\n",
        "#     outputs=dict(\n",
        "#         train_data=Output(type=\"uri_folder\", mode=\"rw_mount\"),\n",
        "#         test_data=Output(type=\"uri_folder\", mode=\"rw_mount\"),\n",
        "#     ),\n",
        "#     # The source folder of the component\n",
        "#     code=data_prep_src_dir,\n",
        "#     command=\"\"\"python data_prep.py \\\n",
        "#             --data ${{inputs.data}} --test_train_ratio ${{inputs.test_train_ratio}} \\\n",
        "#             --train_data ${{outputs.train_data}} --test_data ${{outputs.test_data}} \\\n",
        "#             \"\"\",\n",
        "#     environment=f\"{pipeline_job_env.name}:{pipeline_job_env.version}\",\n",
        "# )"
      ],
      "outputs": [],
      "execution_count": 89,
      "metadata": {
        "gather": {
          "logged": 1678182218566
        },
        "name": "data_prep_component"
      }
    },
    {
      "cell_type": "markdown",
      "source": [
        "Optionally, register the component in the workspace for future re-use. **command()** is a component builder, in order to fetch the component itself, we need to call the **.component** property from it."
      ],
      "metadata": {
        "nteract": {
          "transient": {
            "deleting": false
          }
        }
      }
    },
    {
      "cell_type": "code",
      "source": [
        "# # Now we register the component to the workspace\n",
        "# data_prep_component = ml_client.create_or_update(data_prep_component.component)\n",
        "\n",
        "# # Create (register) the component in your workspace\n",
        "# print(\n",
        "#     f\"Component {data_prep_component.name} with Version {data_prep_component.version} is registered\"\n",
        "# )"
      ],
      "outputs": [
        {
          "output_type": "stream",
          "name": "stdout",
          "text": "Component data_prep_credit_defaults with Version 2023-03-07-09-43-39-1746682 is registered\n"
        }
      ],
      "execution_count": 90,
      "metadata": {
        "gather": {
          "logged": 1678182220376
        }
      }
    },
    {
      "cell_type": "markdown",
      "source": [
        "## Create component 2: training (using yaml definition)\n",
        "\n",
        "The second component that you'll create will consume the training and test data, train a tree based model and return the output model. You'll use Azure ML logging capabilities to record and visualize the learning progress.\n",
        "\n",
        "You used the `command` class to create your first component. This time you'll use the yaml definition to define the second component. Each method has its own advantages. A yaml definition can actually be checked-in along the code, and would provide a readable history tracking. Also, the same yaml file can be used in the CLI for component deficnition. The programmatic method using `command` can be easier with built-in class documentation and code completion.\n",
        "\n",
        "\n",
        "Create the directory for this component:"
      ],
      "metadata": {}
    },
    {
      "cell_type": "code",
      "source": [
        "import os\n",
        "\n",
        "train_src_dir = \"./components/train\"\n",
        "os.makedirs(train_src_dir, exist_ok=True)"
      ],
      "outputs": [],
      "execution_count": 85,
      "metadata": {
        "attributes": {
          "classes": [
            "Python"
          ],
          "id": ""
        },
        "gather": {
          "logged": 1678280360867
        },
        "name": "train_src_dir"
      }
    },
    {
      "cell_type": "markdown",
      "source": [
        "Create the training script in the directory:"
      ],
      "metadata": {}
    },
    {
      "cell_type": "markdown",
      "source": [
        "As you can see in this training script, once the model is trained, the model file is saved and registered to the workspace. Now you can use the registered model in inferencing endpoints.\n",
        "\n",
        "\n",
        "For the environment of this step, you'll use one of the built-in (curated) Azure ML environments. The tag `azureml`, tells the system to use look for the name in curated environments.\n",
        "\n",
        "First, create the *yaml* file describing the component:"
      ],
      "metadata": {}
    },
    {
      "cell_type": "markdown",
      "source": [
        "Once the `yaml` file and the script are ready, you can create your component using `load_component()`. "
      ],
      "metadata": {}
    },
    {
      "cell_type": "code",
      "source": [
        "# importing the Component Package\n",
        "from azure.ai.ml import load_component\n",
        "\n",
        "# Loading the component from the yml file\n",
        "train_component = load_component(source=os.path.join(train_src_dir, \"train.yml\"))"
      ],
      "outputs": [],
      "execution_count": 86,
      "metadata": {
        "attributes": {
          "classes": [
            "Python"
          ],
          "id": ""
        },
        "gather": {
          "logged": 1678280364437
        },
        "name": "train_component"
      }
    },
    {
      "cell_type": "markdown",
      "source": [
        "## now create and register the component:(option)"
      ],
      "metadata": {}
    },
    {
      "cell_type": "code",
      "source": [
        "# Now we register the component to the workspace\n",
        "train_component = ml_client.create_or_update(train_component)\n",
        "\n",
        "# Create (register) the component in your workspace\n",
        "print(\n",
        "    f\"Component {train_component.name} with Version {train_component.version} is registered\"\n",
        ")"
      ],
      "outputs": [
        {
          "output_type": "stream",
          "name": "stdout",
          "text": "Component train_credit_defaults_model with Version 2023-03-07-14-15-54-0513027 is registered\n"
        }
      ],
      "execution_count": 16,
      "metadata": {
        "attributes": {
          "classes": [
            "Python"
          ],
          "id": ""
        },
        "gather": {
          "logged": 1678198554694
        },
        "name": "update-train_component"
      }
    },
    {
      "cell_type": "markdown",
      "source": [
        "## Create component 3: Scoring (using yaml definition)\n"
      ],
      "metadata": {
        "nteract": {
          "transient": {
            "deleting": false
          }
        }
      }
    },
    {
      "cell_type": "code",
      "source": [
        "import os\n",
        "\n",
        "score_src_dir = \"./components/score\"\n",
        "os.makedirs(score_src_dir, exist_ok=True)"
      ],
      "outputs": [],
      "execution_count": 87,
      "metadata": {
        "gather": {
          "logged": 1678280368459
        },
        "jupyter": {
          "outputs_hidden": false,
          "source_hidden": false
        },
        "nteract": {
          "transient": {
            "deleting": false
          }
        }
      }
    },
    {
      "cell_type": "code",
      "source": [
        "# importing the Component Package\n",
        "from azure.ai.ml import load_component\n",
        "# Loading the component from the yml file\n",
        "score_component = load_component(source=os.path.join(score_src_dir, \"score.yml\"))"
      ],
      "outputs": [],
      "execution_count": 88,
      "metadata": {
        "gather": {
          "logged": 1678280370280
        },
        "jupyter": {
          "outputs_hidden": false,
          "source_hidden": false
        },
        "nteract": {
          "transient": {
            "deleting": false
          }
        }
      }
    },
    {
      "cell_type": "code",
      "source": [
        "# Now we register the component to the workspace\n",
        "score_component = ml_client.create_or_update(score_component)\n",
        "\n",
        "# Create (register) the component in your workspace\n",
        "print(\n",
        "    f\"Component {score_component.name} with Version {score_component.version} is registered\"\n",
        ")"
      ],
      "outputs": [
        {
          "output_type": "stream",
          "name": "stderr",
          "text": "\r\u001b[32mUploading score (0.0 MBs):   0%|          | 0/2041 [00:00<?, ?it/s]\r\u001b[32mUploading score (0.0 MBs): 100%|██████████| 2041/2041 [00:00<00:00, 65580.68it/s]\n\u001b[39m\n\n"
        },
        {
          "output_type": "stream",
          "name": "stdout",
          "text": "Component score_data with Version 2023-03-07-14-16-12-0679943 is registered\n"
        }
      ],
      "execution_count": 21,
      "metadata": {
        "gather": {
          "logged": 1678198572599
        },
        "jupyter": {
          "outputs_hidden": false,
          "source_hidden": false
        },
        "nteract": {
          "transient": {
            "deleting": false
          }
        }
      }
    },
    {
      "cell_type": "markdown",
      "source": [
        "## Create the pipeline from components\n",
        "\n",
        "Now that both your components are defined and registered, you can start implementing the pipeline."
      ],
      "metadata": {}
    },
    {
      "cell_type": "markdown",
      "source": [
        "Here, you'll use *input data*, *split ratio* and *registered model name* as input variables. Then call the components and connect them via their inputs /outputs identifiers. The outputs of each step can be accessed via the `.outputs` property."
      ],
      "metadata": {}
    },
    {
      "cell_type": "markdown",
      "source": [
        "The python functions returned by `load_component()` work as any regular python function that we'll use within a pipeline to call each step.\n",
        "\n",
        "To code the pipeline, we use a specific `@dsl.pipeline` decorator that identifies the Azure ML pipelines. In the decorator, we can specify the pipeline description and default resources like compute and storage. Like a python function, pipelines can have inputs, you can then create multiple instances of a single pipeline with different inputs.\n",
        "\n",
        "Here, we used *input data*, *split ratio* and *registered model name* as input variables. We then call the components and connect them via their inputs /outputs identifiers. The outputs of each step can be accessed via the `.outputs` property."
      ],
      "metadata": {
        "attributes": {
          "classes": [
            "Python"
          ],
          "id": ""
        }
      }
    },
    {
      "cell_type": "code",
      "source": [
        "# the dsl decorator tells the sdk that we are defining an Azure ML pipeline\n",
        "from azure.ai.ml import dsl, Input, Output\n",
        "\n",
        "\n",
        "@dsl.pipeline(\n",
        "    compute=cpu_compute_target,\n",
        "    description=\"E2E data_perp-train pipeline\",\n",
        ")\n",
        "def credit_defaults_pipeline(\n",
        "    pipeline_job_data_input,\n",
        "    pipeline_job_test_train_ratio,\n",
        "    pipeline_job_learning_rate,\n",
        "    pipeline_job_registered_model_name,\n",
        "    pipeline_job_evaldata_input,\n",
        "):\n",
        "    # using data_prep_function like a python call with its own inputs\n",
        "    data_prep_job = data_prep_component(\n",
        "        data=pipeline_job_data_input,\n",
        "        test_train_ratio=pipeline_job_test_train_ratio,\n",
        "    )\n",
        "\n",
        "    # using train_func like a python call with its own inputs\n",
        "    train_job = train_component(\n",
        "        train_data=data_prep_job.outputs.train_data,  # note: using outputs from previous step\n",
        "        test_data=data_prep_job.outputs.test_data,  # note: using outputs from previous step\n",
        "        learning_rate=pipeline_job_learning_rate,  # note: using a pipeline input as parameter\n",
        "        registered_model_name=pipeline_job_registered_model_name,\n",
        "    )\n",
        "\n",
        "    score_job = score_component(\n",
        "        model_input=train_job.outputs.model,\n",
        "        test_data=pipeline_job_evaldata_input,\n",
        "    )\n",
        "\n",
        "    # a pipeline returns a dictionary of outputs\n",
        "    # keys will code for the pipeline output identifier\n",
        "    return {\n",
        "        \"pipeline_job_train_data\": data_prep_job.outputs.train_data,\n",
        "        \"pipeline_job_test_data\": data_prep_job.outputs.test_data,\n",
        "        \"pipeline_job_model\": train_job.outputs.model,\n",
        "        \"pipeline_job_score\": score_job.outputs.score_output,\n",
        "    }"
      ],
      "outputs": [],
      "execution_count": 131,
      "metadata": {
        "attributes": {
          "classes": [
            "Python"
          ],
          "id": ""
        },
        "gather": {
          "logged": 1678282639218
        },
        "name": "pipeline"
      }
    },
    {
      "cell_type": "markdown",
      "source": [
        "Now use your pipeline definition to instantiate a pipeline with your dataset, split rate of choice and the name you picked for your model."
      ],
      "metadata": {}
    },
    {
      "cell_type": "code",
      "source": [
        "credit_data"
      ],
      "outputs": [
        {
          "output_type": "execute_result",
          "execution_count": 132,
          "data": {
            "text/plain": "Data({'skip_validation': False, 'mltable_schema_url': None, 'referenced_uris': None, 'type': 'uri_file', 'is_anonymous': False, 'auto_increment_version': False, 'name': 'sscinpudata', 'description': 'Dataset for credit card defaults', 'tags': {'source_type': 'web', 'source': 'UCI ML Repo'}, 'properties': {}, 'id': '/subscriptions/996049d2-a088-4535-84c6-293862437c2e/resourceGroups/rg-aml-demo/providers/Microsoft.MachineLearningServices/workspaces/ssc-mlops/data/sscinpudata/versions/4', 'Resource__source_path': None, 'base_path': '/mnt/batch/tasks/shared/LS_root/mounts/clusters/swkim1/code/Users/swkim/aml-ds-workflow', 'creation_context': <azure.ai.ml.entities._system_data.SystemData object at 0x7f90e689af50>, 'serialize': <msrest.serialization.Serializer object at 0x7f90e68979d0>, 'version': '4', 'latest_version': None, 'path': 'https://sscdata.blob.core.windows.net/input/creditcardclients.xls', 'datastore': None})"
          },
          "metadata": {}
        }
      ],
      "execution_count": 132,
      "metadata": {
        "jupyter": {
          "source_hidden": false,
          "outputs_hidden": false
        },
        "nteract": {
          "transient": {
            "deleting": false
          }
        },
        "gather": {
          "logged": 1678282642121
        }
      }
    },
    {
      "cell_type": "code",
      "source": [
        "credit_evaldata.path"
      ],
      "outputs": [
        {
          "output_type": "execute_result",
          "execution_count": 124,
          "data": {
            "text/plain": "'azureml://subscriptions/996049d2-a088-4535-84c6-293862437c2e/resourcegroups/rg-aml-demo/workspaces/ssc-mlops/datastores/sscblobdata/paths/creditcardclientstest.xls'"
          },
          "metadata": {}
        }
      ],
      "execution_count": 124,
      "metadata": {
        "jupyter": {
          "source_hidden": false,
          "outputs_hidden": false
        },
        "nteract": {
          "transient": {
            "deleting": false
          }
        },
        "gather": {
          "logged": 1678281773736
        }
      }
    },
    {
      "cell_type": "code",
      "source": [
        "registered_model_name = \"credit_defaults_model\"\n",
        "\n",
        "# Let's instantiate the pipeline with the parameters of our choice\n",
        "pipeline = credit_defaults_pipeline(\n",
        "    pipeline_job_data_input=Input(type=\"uri_file\", path=credit_data.path),\n",
        "    pipeline_job_test_train_ratio=0.25,\n",
        "    pipeline_job_learning_rate=0.05,\n",
        "    pipeline_job_registered_model_name=registered_model_name,\n",
        "    pipeline_job_evaldata_input=Input(type=\"uri_file\", path=credit_evaldata.path),\n",
        ")"
      ],
      "outputs": [],
      "execution_count": 133,
      "metadata": {
        "attributes": {
          "classes": [
            "Python"
          ],
          "id": ""
        },
        "gather": {
          "logged": 1678282667588
        },
        "name": "registered_model_name"
      }
    },
    {
      "cell_type": "markdown",
      "source": [
        "## Submit the job \n",
        "\n",
        "It's now time to submit the job to run in Azure ML. This time you'll use `create_or_update`  on `ml_client.jobs`.\n",
        "\n",
        "Here you'll also pass an experiment name. An experiment is a container for all the iterations one does on a certain project. All the jobs submitted under the same experiment name would be listed next to each other in Azure ML studio.\n",
        "\n",
        "Once completed, the pipeline will register a model in your workspace as a result of training."
      ],
      "metadata": {}
    },
    {
      "cell_type": "code",
      "source": [
        "import webbrowser\n",
        "\n",
        "# submit the pipeline job\n",
        "pipeline_job = ml_client.jobs.create_or_update(\n",
        "    pipeline,\n",
        "    # Project's name\n",
        "    experiment_name=\"e2e_registered_components\",\n",
        ")\n",
        "# open the pipeline in web browser\n",
        "webbrowser.open(pipeline_job.studio_url)"
      ],
      "outputs": [
        {
          "output_type": "execute_result",
          "execution_count": 134,
          "data": {
            "text/plain": "False"
          },
          "metadata": {}
        }
      ],
      "execution_count": 134,
      "metadata": {
        "gather": {
          "logged": 1678282676124
        },
        "name": "returned_job"
      }
    },
    {
      "cell_type": "code",
      "source": [
        "ml_client.jobs.stream(pipeline_job.name)"
      ],
      "outputs": [
        {
          "output_type": "stream",
          "name": "stdout",
          "text": "RunId: tender_gas_l9tgc214w7\nWeb View: https://ml.azure.com/runs/tender_gas_l9tgc214w7?wsid=/subscriptions/996049d2-a088-4535-84c6-293862437c2e/resourcegroups/rg-aml-demo/workspaces/ssc-mlops\n\nStreaming logs/azureml/executionlogs.txt\n========================================\n\n[2023-03-08 13:37:56Z] Submitting 1 runs, first five are: 59fb6e48:bbf07388-4533-411a-9233-62dedca3a8f5\n[2023-03-08 13:40:50Z] Execution of experiment failed, update experiment status and cancel running nodes.\n\nExecution Summary\n=================\nRunId: tender_gas_l9tgc214w7\nWeb View: https://ml.azure.com/runs/tender_gas_l9tgc214w7?wsid=/subscriptions/996049d2-a088-4535-84c6-293862437c2e/resourcegroups/rg-aml-demo/workspaces/ssc-mlops\n"
        },
        {
          "output_type": "error",
          "ename": "JobException",
          "evalue": "Exception : \n {\n    \"error\": {\n        \"code\": \"UserError\",\n        \"message\": \"Pipeline has some failed steps. See child run or execution logs for more details.\",\n        \"message_format\": \"Pipeline has some failed steps. {0}\",\n        \"message_parameters\": {},\n        \"reference_code\": \"PipelineHasStepJobFailed\",\n        \"details\": []\n    },\n    \"environment\": \"koreacentral\",\n    \"location\": \"koreacentral\",\n    \"time\": \"2023-03-08T13:40:50.038115Z\",\n    \"component_name\": \"\"\n} ",
          "traceback": [
            "\u001b[0;31m---------------------------------------------------------------------------\u001b[0m",
            "\u001b[0;31mJobException\u001b[0m                              Traceback (most recent call last)",
            "Input \u001b[0;32mIn [135]\u001b[0m, in \u001b[0;36m<cell line: 1>\u001b[0;34m()\u001b[0m\n\u001b[0;32m----> 1\u001b[0m \u001b[43mml_client\u001b[49m\u001b[38;5;241;43m.\u001b[39;49m\u001b[43mjobs\u001b[49m\u001b[38;5;241;43m.\u001b[39;49m\u001b[43mstream\u001b[49m\u001b[43m(\u001b[49m\u001b[43mpipeline_job\u001b[49m\u001b[38;5;241;43m.\u001b[39;49m\u001b[43mname\u001b[49m\u001b[43m)\u001b[49m\n",
            "File \u001b[0;32m/anaconda/envs/azureml_py310_sdkv2/lib/python3.10/site-packages/azure/core/tracing/decorator.py:78\u001b[0m, in \u001b[0;36mdistributed_trace.<locals>.decorator.<locals>.wrapper_use_tracer\u001b[0;34m(*args, **kwargs)\u001b[0m\n\u001b[1;32m     76\u001b[0m span_impl_type \u001b[38;5;241m=\u001b[39m settings\u001b[38;5;241m.\u001b[39mtracing_implementation()\n\u001b[1;32m     77\u001b[0m \u001b[38;5;28;01mif\u001b[39;00m span_impl_type \u001b[38;5;129;01mis\u001b[39;00m \u001b[38;5;28;01mNone\u001b[39;00m:\n\u001b[0;32m---> 78\u001b[0m     \u001b[38;5;28;01mreturn\u001b[39;00m \u001b[43mfunc\u001b[49m\u001b[43m(\u001b[49m\u001b[38;5;241;43m*\u001b[39;49m\u001b[43margs\u001b[49m\u001b[43m,\u001b[49m\u001b[43m \u001b[49m\u001b[38;5;241;43m*\u001b[39;49m\u001b[38;5;241;43m*\u001b[39;49m\u001b[43mkwargs\u001b[49m\u001b[43m)\u001b[49m\n\u001b[1;32m     80\u001b[0m \u001b[38;5;66;03m# Merge span is parameter is set, but only if no explicit parent are passed\u001b[39;00m\n\u001b[1;32m     81\u001b[0m \u001b[38;5;28;01mif\u001b[39;00m merge_span \u001b[38;5;129;01mand\u001b[39;00m \u001b[38;5;129;01mnot\u001b[39;00m passed_in_parent:\n",
            "File \u001b[0;32m/anaconda/envs/azureml_py310_sdkv2/lib/python3.10/site-packages/azure/ai/ml/operations/_job_operations.py:617\u001b[0m, in \u001b[0;36mJobOperations.stream\u001b[0;34m(self, name)\u001b[0m\n\u001b[1;32m    614\u001b[0m \u001b[38;5;28;01mif\u001b[39;00m _is_pipeline_child_job(job_object):\n\u001b[1;32m    615\u001b[0m     \u001b[38;5;28;01mraise\u001b[39;00m PipelineChildJobError(job_id\u001b[38;5;241m=\u001b[39mjob_object\u001b[38;5;241m.\u001b[39mid)\n\u001b[0;32m--> 617\u001b[0m \u001b[38;5;28;43mself\u001b[39;49m\u001b[38;5;241;43m.\u001b[39;49m\u001b[43m_stream_logs_until_completion\u001b[49m\u001b[43m(\u001b[49m\n\u001b[1;32m    618\u001b[0m \u001b[43m    \u001b[49m\u001b[38;5;28;43mself\u001b[39;49m\u001b[38;5;241;43m.\u001b[39;49m\u001b[43m_runs_operations\u001b[49m\u001b[43m,\u001b[49m\u001b[43m \u001b[49m\u001b[43mjob_object\u001b[49m\u001b[43m,\u001b[49m\u001b[43m \u001b[49m\u001b[38;5;28;43mself\u001b[39;49m\u001b[38;5;241;43m.\u001b[39;49m\u001b[43m_datastore_operations\u001b[49m\u001b[43m,\u001b[49m\u001b[43m \u001b[49m\u001b[43mrequests_pipeline\u001b[49m\u001b[38;5;241;43m=\u001b[39;49m\u001b[38;5;28;43mself\u001b[39;49m\u001b[38;5;241;43m.\u001b[39;49m\u001b[43m_requests_pipeline\u001b[49m\n\u001b[1;32m    619\u001b[0m \u001b[43m\u001b[49m\u001b[43m)\u001b[49m\n",
            "File \u001b[0;32m/anaconda/envs/azureml_py310_sdkv2/lib/python3.10/site-packages/azure/ai/ml/operations/_job_ops_helper.py:297\u001b[0m, in \u001b[0;36mstream_logs_until_completion\u001b[0;34m(run_operations, job_resource, datastore_operations, raise_exception_on_failed_job, requests_pipeline)\u001b[0m\n\u001b[1;32m    295\u001b[0m         file_handle\u001b[38;5;241m.\u001b[39mwrite(\u001b[38;5;124m\"\u001b[39m\u001b[38;5;130;01m\\n\u001b[39;00m\u001b[38;5;124m\"\u001b[39m)\n\u001b[1;32m    296\u001b[0m     \u001b[38;5;28;01melse\u001b[39;00m:\n\u001b[0;32m--> 297\u001b[0m         \u001b[38;5;28;01mraise\u001b[39;00m JobException(\n\u001b[1;32m    298\u001b[0m             message\u001b[38;5;241m=\u001b[39m\u001b[38;5;124m\"\u001b[39m\u001b[38;5;124mException : \u001b[39m\u001b[38;5;130;01m\\n\u001b[39;00m\u001b[38;5;124m \u001b[39m\u001b[38;5;132;01m{}\u001b[39;00m\u001b[38;5;124m \u001b[39m\u001b[38;5;124m\"\u001b[39m\u001b[38;5;241m.\u001b[39mformat(json\u001b[38;5;241m.\u001b[39mdumps(error, indent\u001b[38;5;241m=\u001b[39m\u001b[38;5;241m4\u001b[39m)),\n\u001b[1;32m    299\u001b[0m             target\u001b[38;5;241m=\u001b[39mErrorTarget\u001b[38;5;241m.\u001b[39mJOB,\n\u001b[1;32m    300\u001b[0m             no_personal_data_message\u001b[38;5;241m=\u001b[39m\u001b[38;5;124m\"\u001b[39m\u001b[38;5;124mException raised on failed job.\u001b[39m\u001b[38;5;124m\"\u001b[39m,\n\u001b[1;32m    301\u001b[0m             error_category\u001b[38;5;241m=\u001b[39mErrorCategory\u001b[38;5;241m.\u001b[39mSYSTEM_ERROR,\n\u001b[1;32m    302\u001b[0m         )\n\u001b[1;32m    304\u001b[0m file_handle\u001b[38;5;241m.\u001b[39mwrite(\u001b[38;5;124m\"\u001b[39m\u001b[38;5;130;01m\\n\u001b[39;00m\u001b[38;5;124m\"\u001b[39m)\n\u001b[1;32m    305\u001b[0m file_handle\u001b[38;5;241m.\u001b[39mflush()\n",
            "\u001b[0;31mJobException\u001b[0m: Exception : \n {\n    \"error\": {\n        \"code\": \"UserError\",\n        \"message\": \"Pipeline has some failed steps. See child run or execution logs for more details.\",\n        \"message_format\": \"Pipeline has some failed steps. {0}\",\n        \"message_parameters\": {},\n        \"reference_code\": \"PipelineHasStepJobFailed\",\n        \"details\": []\n    },\n    \"environment\": \"koreacentral\",\n    \"location\": \"koreacentral\",\n    \"time\": \"2023-03-08T13:40:50.038115Z\",\n    \"component_name\": \"\"\n} "
          ]
        }
      ],
      "execution_count": 135,
      "metadata": {
        "gather": {
          "logged": 1678282877171
        },
        "jupyter": {
          "outputs_hidden": false,
          "source_hidden": false
        },
        "nteract": {
          "transient": {
            "deleting": false
          }
        }
      }
    },
    {
      "cell_type": "markdown",
      "source": [
        "You can track the progress of your pipeline, by using the link generated in the cell above or in this notebook using the following code:\n",
        "```python\n",
        "    ml_client.jobs.stream(pipeline_job.name)\n",
        "```\n",
        "\n",
        "When you select on each component, you'll see more information about the results of that component. \n",
        "There are two important parts to look for at this stage:\n",
        "* `Outputs+logs` > `user_logs` > `std_log.txt`\n",
        "This section shows the script run sdtout."
      ],
      "metadata": {
        "nteract": {
          "transient": {
            "deleting": false
          }
        }
      }
    },
    {
      "cell_type": "markdown",
      "source": [
        "* `Outputs+logs` > `Metric`\n",
        "This section shows different logged metrics. In this example. mlflow `autologging`, has automatically logged the training metrics."
      ],
      "metadata": {
        "nteract": {
          "transient": {
            "deleting": false
          }
        }
      }
    },
    {
      "cell_type": "markdown",
      "source": [
        "## "
      ],
      "metadata": {
        "nteract": {
          "transient": {
            "deleting": false
          }
        }
      }
    },
    {
      "cell_type": "markdown",
      "source": [
        "## e2e_registered_component 실험 리스트 조회"
      ],
      "metadata": {
        "nteract": {
          "transient": {
            "deleting": false
          }
        }
      }
    },
    {
      "cell_type": "code",
      "source": [
        "import mlflow\n",
        "\n",
        "exp = mlflow.get_experiment_by_name(\"e2e_registered_components\")\n",
        "exp"
      ],
      "outputs": [
        {
          "output_type": "execute_result",
          "execution_count": 23,
          "data": {
            "text/plain": "<Experiment: artifact_location='', creation_time=1678064718535, experiment_id='589ba941-0fdf-41f1-8a44-39204466f49a', last_update_time=None, lifecycle_stage='active', name='e2e_registered_components', tags={}>"
          },
          "metadata": {}
        }
      ],
      "execution_count": 23,
      "metadata": {
        "gather": {
          "logged": 1678182350351
        },
        "jupyter": {
          "outputs_hidden": false,
          "source_hidden": false
        },
        "nteract": {
          "transient": {
            "deleting": false
          }
        }
      }
    },
    {
      "cell_type": "code",
      "source": [
        "run_list = mlflow.search_runs(exp.experiment_id)\n",
        "run_list"
      ],
      "outputs": [
        {
          "output_type": "execute_result",
          "execution_count": 24,
          "data": {
            "text/html": "<div>\n<style scoped>\n    .dataframe tbody tr th:only-of-type {\n        vertical-align: middle;\n    }\n\n    .dataframe tbody tr th {\n        vertical-align: top;\n    }\n\n    .dataframe thead th {\n        text-align: right;\n    }\n</style>\n<table border=\"1\" class=\"dataframe\">\n  <thead>\n    <tr style=\"text-align: right;\">\n      <th></th>\n      <th>run_id</th>\n      <th>experiment_id</th>\n      <th>status</th>\n      <th>artifact_uri</th>\n      <th>start_time</th>\n      <th>end_time</th>\n      <th>metrics.num_features</th>\n      <th>metrics.num_samples</th>\n      <th>metrics.training_roc_auc_score</th>\n      <th>metrics.training_score</th>\n      <th>...</th>\n      <th>params.min_weight_fraction_leaf</th>\n      <th>params.min_impurity_decrease</th>\n      <th>params.tol</th>\n      <th>tags.mlflow.user</th>\n      <th>tags.mlflow.rootRunId</th>\n      <th>tags.azureml.pipeline</th>\n      <th>tags.azureml.nodeid</th>\n      <th>tags.mlflow.parentRunId</th>\n      <th>tags.estimator_name</th>\n      <th>tags.estimator_class</th>\n    </tr>\n  </thead>\n  <tbody>\n    <tr>\n      <th>0</th>\n      <td>clever_cloud_vjn3fbrmhj</td>\n      <td>589ba941-0fdf-41f1-8a44-39204466f49a</td>\n      <td>FINISHED</td>\n      <td></td>\n      <td>2023-03-06 01:05:19.789000+00:00</td>\n      <td>2023-03-06 01:10:00.856000+00:00</td>\n      <td>NaN</td>\n      <td>NaN</td>\n      <td>NaN</td>\n      <td>NaN</td>\n      <td>...</td>\n      <td>None</td>\n      <td>None</td>\n      <td>None</td>\n      <td>김상우</td>\n      <td>clever_cloud_vjn3fbrmhj</td>\n      <td>None</td>\n      <td>None</td>\n      <td>None</td>\n      <td>None</td>\n      <td>None</td>\n    </tr>\n    <tr>\n      <th>1</th>\n      <td>d7ca41fa-587d-450a-a751-b37a68e80488</td>\n      <td>589ba941-0fdf-41f1-8a44-39204466f49a</td>\n      <td>FINISHED</td>\n      <td></td>\n      <td>2023-03-06 01:07:35.653000+00:00</td>\n      <td>2023-03-06 01:08:36.840000+00:00</td>\n      <td>23.0</td>\n      <td>30000.0</td>\n      <td>NaN</td>\n      <td>NaN</td>\n      <td>...</td>\n      <td>None</td>\n      <td>None</td>\n      <td>None</td>\n      <td>김상우</td>\n      <td>clever_cloud_vjn3fbrmhj</td>\n      <td>clever_cloud_vjn3fbrmhj</td>\n      <td>5751f057</td>\n      <td>clever_cloud_vjn3fbrmhj</td>\n      <td>None</td>\n      <td>None</td>\n    </tr>\n    <tr>\n      <th>2</th>\n      <td>56ff461b-a59f-470d-89e7-79a258edef6b</td>\n      <td>589ba941-0fdf-41f1-8a44-39204466f49a</td>\n      <td>FINISHED</td>\n      <td></td>\n      <td>2023-03-06 01:08:47.631000+00:00</td>\n      <td>2023-03-06 01:09:59.371000+00:00</td>\n      <td>NaN</td>\n      <td>NaN</td>\n      <td>0.795926</td>\n      <td>0.824756</td>\n      <td>...</td>\n      <td>0.0</td>\n      <td>0.0</td>\n      <td>0.0001</td>\n      <td>김상우</td>\n      <td>clever_cloud_vjn3fbrmhj</td>\n      <td>clever_cloud_vjn3fbrmhj</td>\n      <td>f5e3994d</td>\n      <td>clever_cloud_vjn3fbrmhj</td>\n      <td>GradientBoostingClassifier</td>\n      <td>sklearn.ensemble._gb.GradientBoostingClassifier</td>\n    </tr>\n    <tr>\n      <th>3</th>\n      <td>silly_beach_8px3xdh5hc</td>\n      <td>589ba941-0fdf-41f1-8a44-39204466f49a</td>\n      <td>FAILED</td>\n      <td></td>\n      <td>2023-03-07 00:57:43.219000+00:00</td>\n      <td>2023-03-07 01:00:29.546000+00:00</td>\n      <td>NaN</td>\n      <td>NaN</td>\n      <td>NaN</td>\n      <td>NaN</td>\n      <td>...</td>\n      <td>None</td>\n      <td>None</td>\n      <td>None</td>\n      <td>김상우</td>\n      <td>silly_beach_8px3xdh5hc</td>\n      <td>None</td>\n      <td>None</td>\n      <td>None</td>\n      <td>None</td>\n      <td>None</td>\n    </tr>\n    <tr>\n      <th>4</th>\n      <td>b5f4f39c-6245-458a-870c-e93fe3bb9337</td>\n      <td>589ba941-0fdf-41f1-8a44-39204466f49a</td>\n      <td>FAILED</td>\n      <td></td>\n      <td>2023-03-07 00:59:40.244000+00:00</td>\n      <td>2023-03-07 01:00:27.534000+00:00</td>\n      <td>NaN</td>\n      <td>NaN</td>\n      <td>NaN</td>\n      <td>NaN</td>\n      <td>...</td>\n      <td>None</td>\n      <td>None</td>\n      <td>None</td>\n      <td>김상우</td>\n      <td>silly_beach_8px3xdh5hc</td>\n      <td>silly_beach_8px3xdh5hc</td>\n      <td>67989775</td>\n      <td>silly_beach_8px3xdh5hc</td>\n      <td>None</td>\n      <td>None</td>\n    </tr>\n    <tr>\n      <th>...</th>\n      <td>...</td>\n      <td>...</td>\n      <td>...</td>\n      <td>...</td>\n      <td>...</td>\n      <td>...</td>\n      <td>...</td>\n      <td>...</td>\n      <td>...</td>\n      <td>...</td>\n      <td>...</td>\n      <td>...</td>\n      <td>...</td>\n      <td>...</td>\n      <td>...</td>\n      <td>...</td>\n      <td>...</td>\n      <td>...</td>\n      <td>...</td>\n      <td>...</td>\n      <td>...</td>\n    </tr>\n    <tr>\n      <th>62</th>\n      <td>66b9af80-4b4f-4135-adbb-e8679f334b30</td>\n      <td>589ba941-0fdf-41f1-8a44-39204466f49a</td>\n      <td>FINISHED</td>\n      <td></td>\n      <td>2023-03-08 01:28:24.581000+00:00</td>\n      <td>2023-03-08 01:29:23.450000+00:00</td>\n      <td>NaN</td>\n      <td>NaN</td>\n      <td>NaN</td>\n      <td>NaN</td>\n      <td>...</td>\n      <td>None</td>\n      <td>None</td>\n      <td>None</td>\n      <td>상우 김</td>\n      <td>038dd38d-5e20-4d83-98c0-51e63b9e5d7f</td>\n      <td>038dd38d-5e20-4d83-98c0-51e63b9e5d7f</td>\n      <td>d6588ed4</td>\n      <td>038dd38d-5e20-4d83-98c0-51e63b9e5d7f</td>\n      <td>None</td>\n      <td>None</td>\n    </tr>\n    <tr>\n      <th>63</th>\n      <td>gentle_sprout_tc76m7hz07</td>\n      <td>589ba941-0fdf-41f1-8a44-39204466f49a</td>\n      <td>FINISHED</td>\n      <td></td>\n      <td>2023-03-08 06:15:43.079000+00:00</td>\n      <td>2023-03-08 06:29:30.166000+00:00</td>\n      <td>NaN</td>\n      <td>NaN</td>\n      <td>NaN</td>\n      <td>NaN</td>\n      <td>...</td>\n      <td>None</td>\n      <td>None</td>\n      <td>None</td>\n      <td>김상우</td>\n      <td>gentle_sprout_tc76m7hz07</td>\n      <td>None</td>\n      <td>None</td>\n      <td>None</td>\n      <td>None</td>\n      <td>None</td>\n    </tr>\n    <tr>\n      <th>64</th>\n      <td>beb83111-3746-4c7d-8c79-813fb375d8a8</td>\n      <td>589ba941-0fdf-41f1-8a44-39204466f49a</td>\n      <td>FINISHED</td>\n      <td></td>\n      <td>2023-03-08 06:17:49.622000+00:00</td>\n      <td>2023-03-08 06:18:51.586000+00:00</td>\n      <td>23.0</td>\n      <td>30000.0</td>\n      <td>NaN</td>\n      <td>NaN</td>\n      <td>...</td>\n      <td>None</td>\n      <td>None</td>\n      <td>None</td>\n      <td>김상우</td>\n      <td>gentle_sprout_tc76m7hz07</td>\n      <td>gentle_sprout_tc76m7hz07</td>\n      <td>e2ef7c65</td>\n      <td>gentle_sprout_tc76m7hz07</td>\n      <td>None</td>\n      <td>None</td>\n    </tr>\n    <tr>\n      <th>65</th>\n      <td>47389770-1a72-4bde-9f2e-87d20be938f1</td>\n      <td>589ba941-0fdf-41f1-8a44-39204466f49a</td>\n      <td>FINISHED</td>\n      <td></td>\n      <td>2023-03-08 06:19:33.560000+00:00</td>\n      <td>2023-03-08 06:20:52.020000+00:00</td>\n      <td>NaN</td>\n      <td>NaN</td>\n      <td>0.793657</td>\n      <td>0.822489</td>\n      <td>...</td>\n      <td>0.0</td>\n      <td>0.0</td>\n      <td>0.0001</td>\n      <td>김상우</td>\n      <td>gentle_sprout_tc76m7hz07</td>\n      <td>gentle_sprout_tc76m7hz07</td>\n      <td>d5d8deae</td>\n      <td>gentle_sprout_tc76m7hz07</td>\n      <td>GradientBoostingClassifier</td>\n      <td>sklearn.ensemble._gb.GradientBoostingClassifier</td>\n    </tr>\n    <tr>\n      <th>66</th>\n      <td>5da145cf-0f2f-4688-91ec-e30b991348a1</td>\n      <td>589ba941-0fdf-41f1-8a44-39204466f49a</td>\n      <td>FINISHED</td>\n      <td></td>\n      <td>2023-03-08 06:27:47.033000+00:00</td>\n      <td>2023-03-08 06:28:48.902000+00:00</td>\n      <td>NaN</td>\n      <td>NaN</td>\n      <td>NaN</td>\n      <td>NaN</td>\n      <td>...</td>\n      <td>None</td>\n      <td>None</td>\n      <td>None</td>\n      <td>김상우</td>\n      <td>gentle_sprout_tc76m7hz07</td>\n      <td>gentle_sprout_tc76m7hz07</td>\n      <td>9f937fd4</td>\n      <td>gentle_sprout_tc76m7hz07</td>\n      <td>None</td>\n      <td>None</td>\n    </tr>\n  </tbody>\n</table>\n<p>67 rows × 45 columns</p>\n</div>",
            "text/plain": "                                  run_id  \\\n0                clever_cloud_vjn3fbrmhj   \n1   d7ca41fa-587d-450a-a751-b37a68e80488   \n2   56ff461b-a59f-470d-89e7-79a258edef6b   \n3                 silly_beach_8px3xdh5hc   \n4   b5f4f39c-6245-458a-870c-e93fe3bb9337   \n..                                   ...   \n62  66b9af80-4b4f-4135-adbb-e8679f334b30   \n63              gentle_sprout_tc76m7hz07   \n64  beb83111-3746-4c7d-8c79-813fb375d8a8   \n65  47389770-1a72-4bde-9f2e-87d20be938f1   \n66  5da145cf-0f2f-4688-91ec-e30b991348a1   \n\n                           experiment_id    status artifact_uri  \\\n0   589ba941-0fdf-41f1-8a44-39204466f49a  FINISHED                \n1   589ba941-0fdf-41f1-8a44-39204466f49a  FINISHED                \n2   589ba941-0fdf-41f1-8a44-39204466f49a  FINISHED                \n3   589ba941-0fdf-41f1-8a44-39204466f49a    FAILED                \n4   589ba941-0fdf-41f1-8a44-39204466f49a    FAILED                \n..                                   ...       ...          ...   \n62  589ba941-0fdf-41f1-8a44-39204466f49a  FINISHED                \n63  589ba941-0fdf-41f1-8a44-39204466f49a  FINISHED                \n64  589ba941-0fdf-41f1-8a44-39204466f49a  FINISHED                \n65  589ba941-0fdf-41f1-8a44-39204466f49a  FINISHED                \n66  589ba941-0fdf-41f1-8a44-39204466f49a  FINISHED                \n\n                         start_time                         end_time  \\\n0  2023-03-06 01:05:19.789000+00:00 2023-03-06 01:10:00.856000+00:00   \n1  2023-03-06 01:07:35.653000+00:00 2023-03-06 01:08:36.840000+00:00   \n2  2023-03-06 01:08:47.631000+00:00 2023-03-06 01:09:59.371000+00:00   \n3  2023-03-07 00:57:43.219000+00:00 2023-03-07 01:00:29.546000+00:00   \n4  2023-03-07 00:59:40.244000+00:00 2023-03-07 01:00:27.534000+00:00   \n..                              ...                              ...   \n62 2023-03-08 01:28:24.581000+00:00 2023-03-08 01:29:23.450000+00:00   \n63 2023-03-08 06:15:43.079000+00:00 2023-03-08 06:29:30.166000+00:00   \n64 2023-03-08 06:17:49.622000+00:00 2023-03-08 06:18:51.586000+00:00   \n65 2023-03-08 06:19:33.560000+00:00 2023-03-08 06:20:52.020000+00:00   \n66 2023-03-08 06:27:47.033000+00:00 2023-03-08 06:28:48.902000+00:00   \n\n    metrics.num_features  metrics.num_samples  metrics.training_roc_auc_score  \\\n0                    NaN                  NaN                             NaN   \n1                   23.0              30000.0                             NaN   \n2                    NaN                  NaN                        0.795926   \n3                    NaN                  NaN                             NaN   \n4                    NaN                  NaN                             NaN   \n..                   ...                  ...                             ...   \n62                   NaN                  NaN                             NaN   \n63                   NaN                  NaN                             NaN   \n64                  23.0              30000.0                             NaN   \n65                   NaN                  NaN                        0.793657   \n66                   NaN                  NaN                             NaN   \n\n    metrics.training_score  ...  params.min_weight_fraction_leaf  \\\n0                      NaN  ...                             None   \n1                      NaN  ...                             None   \n2                 0.824756  ...                              0.0   \n3                      NaN  ...                             None   \n4                      NaN  ...                             None   \n..                     ...  ...                              ...   \n62                     NaN  ...                             None   \n63                     NaN  ...                             None   \n64                     NaN  ...                             None   \n65                0.822489  ...                              0.0   \n66                     NaN  ...                             None   \n\n    params.min_impurity_decrease  params.tol  tags.mlflow.user  \\\n0                           None        None               김상우   \n1                           None        None               김상우   \n2                            0.0      0.0001               김상우   \n3                           None        None               김상우   \n4                           None        None               김상우   \n..                           ...         ...               ...   \n62                          None        None              상우 김   \n63                          None        None               김상우   \n64                          None        None               김상우   \n65                           0.0      0.0001               김상우   \n66                          None        None               김상우   \n\n                   tags.mlflow.rootRunId  \\\n0                clever_cloud_vjn3fbrmhj   \n1                clever_cloud_vjn3fbrmhj   \n2                clever_cloud_vjn3fbrmhj   \n3                 silly_beach_8px3xdh5hc   \n4                 silly_beach_8px3xdh5hc   \n..                                   ...   \n62  038dd38d-5e20-4d83-98c0-51e63b9e5d7f   \n63              gentle_sprout_tc76m7hz07   \n64              gentle_sprout_tc76m7hz07   \n65              gentle_sprout_tc76m7hz07   \n66              gentle_sprout_tc76m7hz07   \n\n                   tags.azureml.pipeline tags.azureml.nodeid  \\\n0                                   None                None   \n1                clever_cloud_vjn3fbrmhj            5751f057   \n2                clever_cloud_vjn3fbrmhj            f5e3994d   \n3                                   None                None   \n4                 silly_beach_8px3xdh5hc            67989775   \n..                                   ...                 ...   \n62  038dd38d-5e20-4d83-98c0-51e63b9e5d7f            d6588ed4   \n63                                  None                None   \n64              gentle_sprout_tc76m7hz07            e2ef7c65   \n65              gentle_sprout_tc76m7hz07            d5d8deae   \n66              gentle_sprout_tc76m7hz07            9f937fd4   \n\n                 tags.mlflow.parentRunId         tags.estimator_name  \\\n0                                   None                        None   \n1                clever_cloud_vjn3fbrmhj                        None   \n2                clever_cloud_vjn3fbrmhj  GradientBoostingClassifier   \n3                                   None                        None   \n4                 silly_beach_8px3xdh5hc                        None   \n..                                   ...                         ...   \n62  038dd38d-5e20-4d83-98c0-51e63b9e5d7f                        None   \n63                                  None                        None   \n64              gentle_sprout_tc76m7hz07                        None   \n65              gentle_sprout_tc76m7hz07  GradientBoostingClassifier   \n66              gentle_sprout_tc76m7hz07                        None   \n\n                               tags.estimator_class  \n0                                              None  \n1                                              None  \n2   sklearn.ensemble._gb.GradientBoostingClassifier  \n3                                              None  \n4                                              None  \n..                                              ...  \n62                                             None  \n63                                             None  \n64                                             None  \n65  sklearn.ensemble._gb.GradientBoostingClassifier  \n66                                             None  \n\n[67 rows x 45 columns]"
          },
          "metadata": {}
        }
      ],
      "execution_count": 24,
      "metadata": {
        "gather": {
          "logged": 1678182352668
        },
        "jupyter": {
          "outputs_hidden": false,
          "source_hidden": false
        },
        "nteract": {
          "transient": {
            "deleting": false
          }
        }
      }
    },
    {
      "cell_type": "code",
      "source": [
        "# Get the run with the highest training R2 score\n",
        "run_list = mlflow.search_runs(exp.experiment_id)\n",
        "best_run_result = run_list.fillna(0)"
      ],
      "outputs": [],
      "execution_count": 25,
      "metadata": {
        "gather": {
          "logged": 1678182355897
        },
        "jupyter": {
          "outputs_hidden": false,
          "source_hidden": false
        },
        "nteract": {
          "transient": {
            "deleting": false
          }
        }
      }
    },
    {
      "cell_type": "markdown",
      "source": [
        "## Experiment list 중에서 비교를 원하는 Metric을 선택해서 가장 좋은 값을 가진 experiment id 를 추출한다.\n",
        "아래는 metrics.training_f1_score 값을 기준으로 비교한다."
      ],
      "metadata": {}
    },
    {
      "cell_type": "code",
      "source": [
        "best_run_result = best_run_result.sort_values('metrics.training_f1_score', ascending=False)\n",
        "best_run_result.head()"
      ],
      "outputs": [
        {
          "output_type": "execute_result",
          "execution_count": 46,
          "data": {
            "text/html": "<div>\n<style scoped>\n    .dataframe tbody tr th:only-of-type {\n        vertical-align: middle;\n    }\n\n    .dataframe tbody tr th {\n        vertical-align: top;\n    }\n\n    .dataframe thead th {\n        text-align: right;\n    }\n</style>\n<table border=\"1\" class=\"dataframe\">\n  <thead>\n    <tr style=\"text-align: right;\">\n      <th></th>\n      <th>run_id</th>\n      <th>experiment_id</th>\n      <th>status</th>\n      <th>artifact_uri</th>\n      <th>start_time</th>\n      <th>end_time</th>\n      <th>metrics.num_features</th>\n      <th>metrics.num_samples</th>\n      <th>metrics.training_roc_auc_score</th>\n      <th>metrics.training_score</th>\n      <th>...</th>\n      <th>params.min_weight_fraction_leaf</th>\n      <th>params.min_impurity_decrease</th>\n      <th>params.tol</th>\n      <th>tags.mlflow.user</th>\n      <th>tags.mlflow.rootRunId</th>\n      <th>tags.azureml.pipeline</th>\n      <th>tags.azureml.nodeid</th>\n      <th>tags.mlflow.parentRunId</th>\n      <th>tags.estimator_name</th>\n      <th>tags.estimator_class</th>\n    </tr>\n  </thead>\n  <tbody>\n    <tr>\n      <th>12</th>\n      <td>874b1810-0d0f-4d76-8ffa-770ac53b6c6d</td>\n      <td>589ba941-0fdf-41f1-8a44-39204466f49a</td>\n      <td>FINISHED</td>\n      <td></td>\n      <td>2023-03-07 09:43:48.825000+00:00</td>\n      <td>2023-03-07 09:43:48.851000+00:00</td>\n      <td>0.0</td>\n      <td>0.0</td>\n      <td>0.793803</td>\n      <td>0.826889</td>\n      <td>...</td>\n      <td>0.0</td>\n      <td>0.0</td>\n      <td>0.0001</td>\n      <td>김상우</td>\n      <td>serene_ocean_m32ymk9k4n</td>\n      <td>serene_ocean_m32ymk9k4n</td>\n      <td>c5d10fa7</td>\n      <td>serene_ocean_m32ymk9k4n</td>\n      <td>GradientBoostingClassifier</td>\n      <td>sklearn.ensemble._gb.GradientBoostingClassifier</td>\n    </tr>\n    <tr>\n      <th>9</th>\n      <td>8a29575c-7838-4400-b300-1109f5b10a25</td>\n      <td>589ba941-0fdf-41f1-8a44-39204466f49a</td>\n      <td>FINISHED</td>\n      <td></td>\n      <td>2023-03-07 01:38:38.841000+00:00</td>\n      <td>2023-03-07 01:39:43.024000+00:00</td>\n      <td>0.0</td>\n      <td>0.0</td>\n      <td>0.793803</td>\n      <td>0.826889</td>\n      <td>...</td>\n      <td>0.0</td>\n      <td>0.0</td>\n      <td>0.0001</td>\n      <td>김상우</td>\n      <td>willing_house_7kpklq0km7</td>\n      <td>willing_house_7kpklq0km7</td>\n      <td>72679786</td>\n      <td>willing_house_7kpklq0km7</td>\n      <td>GradientBoostingClassifier</td>\n      <td>sklearn.ensemble._gb.GradientBoostingClassifier</td>\n    </tr>\n    <tr>\n      <th>21</th>\n      <td>a32b1c5a-c3d3-4a6a-bd9e-1713c07f3fa3</td>\n      <td>589ba941-0fdf-41f1-8a44-39204466f49a</td>\n      <td>FINISHED</td>\n      <td></td>\n      <td>2023-03-07 12:23:22.637000+00:00</td>\n      <td>2023-03-07 12:23:22.687000+00:00</td>\n      <td>0.0</td>\n      <td>0.0</td>\n      <td>0.793968</td>\n      <td>0.824622</td>\n      <td>...</td>\n      <td>0.0</td>\n      <td>0.0</td>\n      <td>0.0001</td>\n      <td>상우 김</td>\n      <td>81dbf6f3-f12f-42dc-acfc-f4d7e084e1e5</td>\n      <td>81dbf6f3-f12f-42dc-acfc-f4d7e084e1e5</td>\n      <td>fe79cc8c</td>\n      <td>81dbf6f3-f12f-42dc-acfc-f4d7e084e1e5</td>\n      <td>GradientBoostingClassifier</td>\n      <td>sklearn.ensemble._gb.GradientBoostingClassifier</td>\n    </tr>\n    <tr>\n      <th>15</th>\n      <td>391380da-2574-4388-9b90-98463f6be61e</td>\n      <td>589ba941-0fdf-41f1-8a44-39204466f49a</td>\n      <td>FINISHED</td>\n      <td></td>\n      <td>2023-03-07 11:41:27.036000+00:00</td>\n      <td>2023-03-07 11:42:37.181000+00:00</td>\n      <td>0.0</td>\n      <td>0.0</td>\n      <td>0.793968</td>\n      <td>0.824622</td>\n      <td>...</td>\n      <td>0.0</td>\n      <td>0.0</td>\n      <td>0.0001</td>\n      <td>김상우</td>\n      <td>heroic_toe_cfdh5l138j</td>\n      <td>heroic_toe_cfdh5l138j</td>\n      <td>814d99f3</td>\n      <td>heroic_toe_cfdh5l138j</td>\n      <td>GradientBoostingClassifier</td>\n      <td>sklearn.ensemble._gb.GradientBoostingClassifier</td>\n    </tr>\n    <tr>\n      <th>46</th>\n      <td>6c155abd-19cb-4ae7-a2cd-48dad7c1ba3e</td>\n      <td>589ba941-0fdf-41f1-8a44-39204466f49a</td>\n      <td>FINISHED</td>\n      <td></td>\n      <td>2023-03-07 13:40:53.261000+00:00</td>\n      <td>2023-03-07 13:40:53.314000+00:00</td>\n      <td>0.0</td>\n      <td>0.0</td>\n      <td>0.793968</td>\n      <td>0.824622</td>\n      <td>...</td>\n      <td>0.0</td>\n      <td>0.0</td>\n      <td>0.0001</td>\n      <td>김상우</td>\n      <td>dynamic_airport_18myqfbrkg</td>\n      <td>dynamic_airport_18myqfbrkg</td>\n      <td>f21f9b2a</td>\n      <td>dynamic_airport_18myqfbrkg</td>\n      <td>GradientBoostingClassifier</td>\n      <td>sklearn.ensemble._gb.GradientBoostingClassifier</td>\n    </tr>\n  </tbody>\n</table>\n<p>5 rows × 46 columns</p>\n</div>",
            "text/plain": "                                  run_id  \\\n12  874b1810-0d0f-4d76-8ffa-770ac53b6c6d   \n9   8a29575c-7838-4400-b300-1109f5b10a25   \n21  a32b1c5a-c3d3-4a6a-bd9e-1713c07f3fa3   \n15  391380da-2574-4388-9b90-98463f6be61e   \n46  6c155abd-19cb-4ae7-a2cd-48dad7c1ba3e   \n\n                           experiment_id    status artifact_uri  \\\n12  589ba941-0fdf-41f1-8a44-39204466f49a  FINISHED                \n9   589ba941-0fdf-41f1-8a44-39204466f49a  FINISHED                \n21  589ba941-0fdf-41f1-8a44-39204466f49a  FINISHED                \n15  589ba941-0fdf-41f1-8a44-39204466f49a  FINISHED                \n46  589ba941-0fdf-41f1-8a44-39204466f49a  FINISHED                \n\n                         start_time                         end_time  \\\n12 2023-03-07 09:43:48.825000+00:00 2023-03-07 09:43:48.851000+00:00   \n9  2023-03-07 01:38:38.841000+00:00 2023-03-07 01:39:43.024000+00:00   \n21 2023-03-07 12:23:22.637000+00:00 2023-03-07 12:23:22.687000+00:00   \n15 2023-03-07 11:41:27.036000+00:00 2023-03-07 11:42:37.181000+00:00   \n46 2023-03-07 13:40:53.261000+00:00 2023-03-07 13:40:53.314000+00:00   \n\n    metrics.num_features  metrics.num_samples  metrics.training_roc_auc_score  \\\n12                   0.0                  0.0                        0.793803   \n9                    0.0                  0.0                        0.793803   \n21                   0.0                  0.0                        0.793968   \n15                   0.0                  0.0                        0.793968   \n46                   0.0                  0.0                        0.793968   \n\n    metrics.training_score  ...  params.min_weight_fraction_leaf  \\\n12                0.826889  ...                              0.0   \n9                 0.826889  ...                              0.0   \n21                0.824622  ...                              0.0   \n15                0.824622  ...                              0.0   \n46                0.824622  ...                              0.0   \n\n    params.min_impurity_decrease  params.tol  tags.mlflow.user  \\\n12                           0.0      0.0001               김상우   \n9                            0.0      0.0001               김상우   \n21                           0.0      0.0001              상우 김   \n15                           0.0      0.0001               김상우   \n46                           0.0      0.0001               김상우   \n\n                   tags.mlflow.rootRunId  \\\n12               serene_ocean_m32ymk9k4n   \n9               willing_house_7kpklq0km7   \n21  81dbf6f3-f12f-42dc-acfc-f4d7e084e1e5   \n15                 heroic_toe_cfdh5l138j   \n46            dynamic_airport_18myqfbrkg   \n\n                   tags.azureml.pipeline tags.azureml.nodeid  \\\n12               serene_ocean_m32ymk9k4n            c5d10fa7   \n9               willing_house_7kpklq0km7            72679786   \n21  81dbf6f3-f12f-42dc-acfc-f4d7e084e1e5            fe79cc8c   \n15                 heroic_toe_cfdh5l138j            814d99f3   \n46            dynamic_airport_18myqfbrkg            f21f9b2a   \n\n                 tags.mlflow.parentRunId         tags.estimator_name  \\\n12               serene_ocean_m32ymk9k4n  GradientBoostingClassifier   \n9               willing_house_7kpklq0km7  GradientBoostingClassifier   \n21  81dbf6f3-f12f-42dc-acfc-f4d7e084e1e5  GradientBoostingClassifier   \n15                 heroic_toe_cfdh5l138j  GradientBoostingClassifier   \n46            dynamic_airport_18myqfbrkg  GradientBoostingClassifier   \n\n                               tags.estimator_class  \n12  sklearn.ensemble._gb.GradientBoostingClassifier  \n9   sklearn.ensemble._gb.GradientBoostingClassifier  \n21  sklearn.ensemble._gb.GradientBoostingClassifier  \n15  sklearn.ensemble._gb.GradientBoostingClassifier  \n46  sklearn.ensemble._gb.GradientBoostingClassifier  \n\n[5 rows x 46 columns]"
          },
          "metadata": {}
        }
      ],
      "execution_count": 46,
      "metadata": {
        "gather": {
          "logged": 1678182358108
        },
        "jupyter": {
          "outputs_hidden": false,
          "source_hidden": false
        },
        "nteract": {
          "transient": {
            "deleting": false
          }
        }
      }
    },
    {
      "cell_type": "code",
      "source": [
        "# Print the best run ID and score\n",
        "if len(best_run_result) > 0:\n",
        "    best_run_id = best_run_result.iloc[0]['run_id']\n",
        "    best_score = best_run_result.iloc[0]['metrics.training_f1_score']    \n",
        "    print(best_run_id, best_score)\n",
        "else:\n",
        "    print(\"No runs found in the experiment.\")"
      ],
      "outputs": [
        {
          "output_type": "stream",
          "name": "stdout",
          "text": "874b1810-0d0f-4d76-8ffa-770ac53b6c6d 0.8054226894119054\n"
        }
      ],
      "execution_count": 47,
      "metadata": {
        "gather": {
          "logged": 1678182360038
        },
        "jupyter": {
          "outputs_hidden": false,
          "source_hidden": false
        },
        "nteract": {
          "transient": {
            "deleting": false
          }
        }
      }
    },
    {
      "cell_type": "markdown",
      "source": [
        "## Deploy the model as an online endpoint (이하는 옵션)\n",
        "\n",
        "Now deploy your machine learning model as a web service in the Azure cloud, an [`online endpoint`](https://docs.microsoft.com/azure/machine-learning/concept-endpoints).\n",
        "\n",
        "To deploy a machine learning service, you usually need:\n",
        "\n",
        "* The model assets (filed, metadata) that you want to deploy. You've already registered these assets in your training component.\n",
        "* Some code to run as a service. The code executes the model on a given input request. This entry script receives data submitted to a deployed web service and passes it to the model, then returns the model's response to the client. The script is specific to your model. The entry script must understand the data that the model expects and returns. When using a MLFlow model, as in this tutorial, this script is automatically created for you. Samples of scoring scripts can be found [here](https://github.com/Azure/azureml-examples/tree/sdk-preview/sdk/endpoints/online).\n",
        "\n"
      ],
      "metadata": {}
    },
    {
      "cell_type": "markdown",
      "source": [
        "## Create a new online endpoint\n",
        "\n",
        "Now that you have a registered model and an inference script, it's time to create your online endpoint. The endpoint name needs to be unique in the entire Azure region. For this tutorial, you'll create a unique name using [`UUID`](https://en.wikipedia.org/wiki/Universally_unique_identifier#:~:text=A%20universally%20unique%20identifier%20(UUID,%2C%20for%20practical%20purposes%2C%20unique.)."
      ],
      "metadata": {}
    },
    {
      "cell_type": "code",
      "source": [
        "import uuid\n",
        "\n",
        "# Creating a unique name for the endpoint\n",
        "online_endpoint_name = \"credit-endpoint-\" + str(uuid.uuid4())[:8]"
      ],
      "outputs": [],
      "execution_count": 105,
      "metadata": {
        "attributes": {
          "classes": [
            "Python"
          ],
          "id": ""
        },
        "gather": {
          "logged": 1678182363100
        },
        "name": "online_endpoint_name"
      }
    },
    {
      "cell_type": "code",
      "source": [
        "from azure.ai.ml.entities import (\n",
        "    ManagedOnlineEndpoint,\n",
        "    ManagedOnlineDeployment,\n",
        "    Model,\n",
        "    Environment,\n",
        ")\n",
        "\n",
        "# create an online endpoint\n",
        "endpoint = ManagedOnlineEndpoint(\n",
        "    name=online_endpoint_name,\n",
        "    description=\"this is an online endpoint\",\n",
        "    auth_mode=\"key\",\n",
        "    tags={\n",
        "        \"training_dataset\": \"credit_defaults\",\n",
        "        \"model_type\": \"sklearn.GradientBoostingClassifier\",\n",
        "    },\n",
        ")\n",
        "\n",
        "endpoint_result = ml_client.begin_create_or_update(endpoint).result()\n",
        "\n",
        "print(\n",
        "    f\"Endpint {endpoint_result.name} provisioning state: {endpoint_result.provisioning_state}\"\n",
        ")"
      ],
      "outputs": [],
      "execution_count": 106,
      "metadata": {
        "attributes": {
          "classes": [
            "Python"
          ],
          "id": ""
        },
        "name": "endpoint"
      }
    },
    {
      "cell_type": "markdown",
      "source": [
        "Once you've created an endpoint, you can retrieve it as below:"
      ],
      "metadata": {}
    },
    {
      "cell_type": "code",
      "source": [
        "endpoint = ml_client.online_endpoints.get(name=online_endpoint_name)\n",
        "\n",
        "print(\n",
        "    f'Endpint \"{endpoint.name}\" with provisioning state \"{endpoint.provisioning_state}\" is retrieved'\n",
        ")"
      ],
      "outputs": [],
      "execution_count": null,
      "metadata": {
        "attributes": {
          "classes": [
            "Python"
          ],
          "id": ""
        },
        "name": "update-endpoint"
      }
    },
    {
      "cell_type": "markdown",
      "source": [
        "## Deploy the model to the endpoint\n",
        "\n",
        "Once the endpoint is created, deploy the model with the entry script. Each endpoint can have multiple deployments and direct traffic to these deployments can be specified using rules. Here you'll create a single deployment that handles 100% of the incoming traffic. We have chosen a color name for the deployment, for example, *blue*, *green*, *red* deployments, which is arbitrary.\n",
        "\n",
        "You can check the *Models* page on the Azure ML studio, to identify the latest version of your registered model. Alternatively, the code below will retrieve the latest version number for you to use."
      ],
      "metadata": {}
    },
    {
      "cell_type": "code",
      "source": [
        "# Let's pick the latest version of the model\n",
        "latest_model_version = max(\n",
        "    [int(m.version) for m in ml_client.models.list(name=registered_model_name)]\n",
        "\n",
        ")\n",
        "latest_model_version"
      ],
      "outputs": [],
      "execution_count": null,
      "metadata": {
        "attributes": {
          "classes": [
            "Python"
          ],
          "id": ""
        },
        "gather": {
          "logged": 1678065474746
        },
        "name": "latest_model_version"
      }
    },
    {
      "cell_type": "code",
      "source": [
        "for m in ml_client.models.list(name=registered_model_name):\n",
        "    print(m.flavors)"
      ],
      "outputs": [],
      "execution_count": null,
      "metadata": {
        "gather": {
          "logged": 1678065800073
        },
        "jupyter": {
          "outputs_hidden": false,
          "source_hidden": false
        },
        "nteract": {
          "transient": {
            "deleting": false
          }
        }
      }
    },
    {
      "cell_type": "markdown",
      "source": [
        "Deploy the latest version of the model.  \n",
        "\n",
        "> [!NOTE]\n",
        "> Expect this deployment to take approximately 6 to 8 minutes."
      ],
      "metadata": {}
    },
    {
      "cell_type": "code",
      "source": [
        "# picking the model to deploy. Here we use the latest version of our registered model\n",
        "model = ml_client.models.get(name=registered_model_name, version=latest_model_version)\n",
        "\n",
        "\n",
        "# create an online deployment.\n",
        "blue_deployment = ManagedOnlineDeployment(\n",
        "    name=\"blue\",\n",
        "    endpoint_name=online_endpoint_name,\n",
        "    model=model,\n",
        "    instance_type=\"Standard_F4s_v2\",\n",
        "    instance_count=1,\n",
        ")\n",
        "\n",
        "blue_deployment_results = ml_client.online_deployments.begin_create_or_update(\n",
        "    blue_deployment\n",
        ").result()\n",
        "\n",
        "print(\n",
        "    f\"Deployment {blue_deployment_results.name} provisioning state: {blue_deployment_results.provisioning_state}\"\n",
        ")"
      ],
      "outputs": [],
      "execution_count": null,
      "metadata": {
        "name": "model"
      }
    },
    {
      "cell_type": "markdown",
      "source": [
        "### Test with a sample query\n",
        "\n",
        "Now that the model is deployed to the endpoint, you can run inference with it.\n",
        "\n",
        "Create a sample request file following the design expected in the run method in the score script."
      ],
      "metadata": {}
    },
    {
      "cell_type": "code",
      "source": [
        "deploy_dir = \"./deploy\"\n",
        "os.makedirs(deploy_dir, exist_ok=True)"
      ],
      "outputs": [],
      "execution_count": null,
      "metadata": {
        "name": "sample-request.json"
      }
    },
    {
      "cell_type": "code",
      "source": [
        "%%writefile {deploy_dir}/sample-request.json\n",
        "{\n",
        "  \"input_data\": {\n",
        "    \"columns\": [0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22],\n",
        "    \"index\": [0, 1],\n",
        "    \"data\": [\n",
        "            [20000,2,2,1,24,2,2,-1,-1,-2,-2,3913,3102,689,0,0,0,0,689,0,0,0,0],\n",
        "            [10, 9, 8, 7, 6, 5, 4, 3, 2, 1, 10, 9, 8, 7, 6, 5, 4, 3, 2, 1, 10, 9, 8]\n",
        "        ]\n",
        "  }\n",
        "}"
      ],
      "outputs": [],
      "execution_count": null,
      "metadata": {
        "name": "write-sample-request"
      }
    },
    {
      "cell_type": "code",
      "source": [
        "# test the blue deployment with some sample data\n",
        "ml_client.online_endpoints.invoke(\n",
        "    endpoint_name=online_endpoint_name,\n",
        "    request_file=\"./deploy/sample-request.json\",\n",
        "    deployment_name=\"blue\",\n",
        ")"
      ],
      "outputs": [],
      "execution_count": null,
      "metadata": {
        "attributes": {
          "classes": [
            "Python"
          ],
          "id": ""
        },
        "name": "ml_client.online_endpoints.invoke"
      }
    },
    {
      "cell_type": "markdown",
      "source": [
        "## Clean up resources\n",
        "\n",
        "If you're not going to use the endpoint, delete it to stop using the resource.  Make sure no other deployments are using an endpoint before you delete it.\n",
        "\n",
        "\n",
        "> [!NOTE]\n",
        "> Expect this step to take approximately 6 to 8 minutes."
      ],
      "metadata": {}
    },
    {
      "cell_type": "code",
      "source": [
        "# ml_client.online_endpoints.begin_delete(name=online_endpoint_name)"
      ],
      "outputs": [],
      "execution_count": null,
      "metadata": {
        "attributes": {
          "classes": [
            "python "
          ],
          "id": ""
        },
        "name": "ml_client.online_endpoints.begin_delete"
      }
    },
    {
      "cell_type": "markdown",
      "source": [
        "## Next Steps\n",
        "\n",
        "Learn more about [Azure ML logging](https://github.com/Azure/azureml-examples/blob/sdk-preview/notebooks/mlflow/mlflow-v1-comparison.ipynb)."
      ],
      "metadata": {}
    }
  ],
  "metadata": {
    "vscode": {
      "interpreter": {
        "hash": "78d13900fb236b5ce4c0b952de9b1270f1802c447ee20a989ea10ffd935aa825"
      }
    },
    "microsoft": {
      "host": {
        "AzureML": {
          "notebookHasBeenCompleted": true
        }
      }
    },
    "kernel_info": {
      "name": "python310-sdkv2"
    },
    "language_info": {
      "name": "python",
      "version": "3.10.9",
      "mimetype": "text/x-python",
      "codemirror_mode": {
        "name": "ipython",
        "version": 3
      },
      "pygments_lexer": "ipython3",
      "nbconvert_exporter": "python",
      "file_extension": ".py"
    },
    "kernelspec": {
      "name": "python310-sdkv2",
      "language": "python",
      "display_name": "Python 3.10 - SDK v2"
    },
    "celltoolbar": "Edit Metadata",
    "categories": [
      "SDK v2",
      "tutorials"
    ],
    "description": {
      "description": "Create production ML pipelines with Python SDK v2 in a Jupyter notebook"
    },
    "nteract": {
      "version": "nteract-front-end@1.0.0"
    }
  },
  "nbformat": 4,
  "nbformat_minor": 1
}